<div class="page-header">
ย <h2>AssetFlow - Gestiรณn de Activos</h2>
ย <button class="btn btn-primary" (click)="abrirFormularioCreacion()" [disabled]="cargando">
ย ย <span>โ</span> Nuevo Activo
ย </button>
</div>

<div *ngIf="cargando" class="loading-overlay">
ย <div class="spinner"></div>
ย <p>Cargando activos...</p>
</div>

<div *ngIf="errorCarga" class="alert alert-danger">
ย <strong>โ๏ธ Error de Conexiรณn</strong>
ย <p>No se pudo conectar con la API del Backend.</p>
ย <button class="btn btn-sm btn-outline-danger" (click)="recargarActivos()">๐ Reintentar</button>
</div>

<div *ngIf="mensajeUsuario" class="alert" [ngClass]="{
ย ย 'alert-success': tipoMensaje === 'success',
ย ย 'alert-danger': tipoMensaje === 'error',
ย ย 'alert-info': tipoMensaje === 'info'
ย }" role="alert">
ย <span class="close-btn" (click)="cerrarMensaje()" title="Cerrar">โ</span>
ย <div style="white-space: pre-line;">{{ mensajeUsuario }}</div>
</div>

<div *ngIf="!cargando">

ย ย <div *ngIf="activosFiltrados$ | async as activos; else cargandoTemplate">

ย ย ย ย <div *ngIf="(activos$ | async)?.length === 0" class="empty-state">
ย ย ย <div class="empty-icon">๐ฆ</div>
ย ย ย <h3>No hay activos registrados</h3>
ย ย ย <p>Comience agregando su primer activo al sistema.</p>
ย ย ย <button class="btn btn-primary" (click)="abrirFormularioCreacion()">
ย ย ย ย โ Crear Primer Activo
ย ย ย </button>
ย ย </div>

ย ย ย ย <div *ngIf="(activos$ | async)?.length! > 0">

ย ย ย <div class="filtros-container">
ย ย ย ย <input type="text" class="form-control" placeholder="๐ Buscar activo..." #searchInput
ย ย ย ย ย (input)="filtrarActivos(searchInput.value)" />

ย ย ย ย <select class="form-control" #categoriaSelect (change)="filtrarPorCategoria(categoriaSelect.value)">
ย ย ย ย ย <option value="">Todas las categorรญas</option>
ย ย ย ย ย <option *ngFor="let categoria of categorias$ | async" [value]="categoria.id">
ย ย ย ย ย ย {{ categoria.nombre }}
ย ย ย ย ย </option>
ย ย ย ย </select>

ย ย ย ย <select class="form-control" #estadoSelect (change)="filtrarPorEstado(estadoSelect.value)">
ย ย ย ย ย <option value="">Todos los estados</option>
ย ย ย ย ย <option value="AC">Activo</option>
ย ย ย ย ย <option value="MA">En Mantenimiento</option>
ย ย ย ย ย <option value="DB">Dado de Baja</option>
ย ย ย ย ย <option value="RE">En Reparaciรณn</option>
ย ย ย ย </select>

ย ย ย ย <button class="btn btn-secondary"
ย ย ย ย ย (click)="limpiarFiltros(); searchInput.value=''; categoriaSelect.value=''; estadoSelect.value='';">
ย ย ย ย ย ๐๏ธ Limpiar Filtros
ย ย ย ย </button>
ย ย ย </div>

ย ย ย <div class="summary-cards" *ngIf="activosFiltrados$ | async as activosFiltrados">
      <div class="summary-card">
        <div class="summary-icon">๐</div>
        <div class="summary-content">
          <span class="summary-label">Total Activos</span>
          <span class="summary-value">{{ activosFiltrados.length }}</span>
        </div>
      </div>
      
      <div class="summary-card">
        <div class="summary-icon">๐ฐ</div>
        <div class="summary-content">
          <span class="summary-label">Valor Total</span>
          <span class="summary-value">
            {{ calcularValorTotal(activosFiltrados) | currency:'USD':'symbol':'1.2-2' }}
          </span>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon">โ</div>
        <div class="summary-content">
          <span class="summary-label">Activos Activos</span>
          <span class="summary-value">
            {{ (contarPorEstado(activosFiltrados))['AC'] || 0 }}
          </span>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon">๐ง</div>
        <div class="summary-content">
          <span class="summary-label">En Mantenimiento</span>
          <span class="summary-value">
            {{ (contarPorEstado(activosFiltrados))['MA'] || 0 }}
          </span>
        </div>
      </div>
    </div>

ย ย ย <div *ngIf="activos.length === 0" class="empty-state">
ย ย ย ย <div class="empty-icon">๐</div>
ย ย ย ย <h3>No hay activos que coincidan con los filtros</h3>
ย ย ย ย <p>Intente ajustar o limpiar los filtros para ver mรกs resultados.</p>
ย ย ย ย <button class="btn btn-secondary"
ย ย ย ย ย (click)="limpiarFiltros(); searchInput.value=''; categoriaSelect.value=''; estadoSelect.value='';">
ย ย ย ย ย ๐๏ธ Limpiar Filtros
ย ย ย ย </button>
ย ย ย </div>

ย ย ย <div *ngIf="activos.length > 0">
ย ย ย ย <app-lista-tabla 
ย ย ย ย ย [datos]="activos" 
ย ย ย ย ย (itemEliminado)="manejarEliminacion($event)"
ย ย ย ย ย (itemEditado)="manejarEdicion($event)"
ย ย ย ย ย (itemVisualizado)="manejarVisualizacion($event)"> ย ย ย ย </app-lista-tabla>
ย ย ย </div>

ย ย </div>
ย </div>
</div>

<ng-template #cargandoTemplate>
ย <div class="loading-placeholder">
ย ย <div class="skeleton-row" *ngFor="let item of [1,2,3,4,5]"></div>
ย </div>
</ng-template>

<div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
ย <div class="modal-content" (click)="$event.stopPropagation()">
ย ย <div class="modal-header">
ย ย ย <h3>{{ modoEdicion ? 'Editar Activo: ' + activoAEditar?.nombre : 'Nuevo Activo' }}</h3>
ย ย ย <button class="close-btn" (click)="cerrarFormulario()">โ</button>
ย ย </div>

ย ย <div class="modal-body">
ย ย ย <app-activo-form [activoInicial]="activoAEditar" [categorias]="(categorias$ | async) || []"
ย ย ย ย (activoGuardado)="manejarGuardado($event)" (cancelar)="cerrarFormulario()"></app-activo-form>
ย ย </div>
ย ย 
ย </div>
</div>

<div *ngIf="mostrarDetalles" class="modal-overlay" (click)="cerrarDetalles()">
ย <div class="modal-content" (click)="$event.stopPropagation()">
ย ย 
ย ย <div class="modal-header">
ย ย ย <h3>Detalles del Activo: {{ activoAVisualizar?.nombre }}</h3>
ย ย ย <button class="close-btn" (click)="cerrarDetalles()">โ</button>
ย ย </div>

ย ย <div class="modal-body" *ngIf="activoAVisualizar as activo">
ย ย ย <div class="details-grid">
ย ย ย ย <p><strong>ID:</strong> {{ activo.id }}</p>
ย ย ย ย <p><strong>Categorรญa:</strong> {{ activo.categoria_nombre }}</p>
ย ย ย ย <p><strong>Valor Inicial:</strong> {{ activo.valor_inicial_formatted || (activo.valor_inicial | currency:'USD':'symbol':'1.2-2') }}</p>
ย ย ย ย <p><strong>Fecha Adquisiciรณn:</strong> {{ activo.fecha_adquisicion | date:'longDate' }}</p>
ย ย ย ย <p><strong>Estado:</strong> {{ activo.estado_display }}</p>

ย ย ย ย </div>
ย ย </div>
ย ย 
ย ย <div class="modal-footer">
ย ย ย <button class="btn btn-secondary" (click)="cerrarDetalles()">Cerrar</button>
ย ย </div>

ย </div>
</div>